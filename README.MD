# ğŸšš Trabalho Final â€“ AutomaÃ§Ã£o em Tempo Real (ATR)

Este repositÃ³rio contÃ©m a implementaÃ§Ã£o de um **caminhÃ£o autÃ´nomo simulado** que se comunica com a **SimulaÃ§Ã£o da Mina** via **MQTT**, processa sensores, monitora falhas e executa lÃ³gica de comando conforme especificaÃ§Ã£o da disciplina **AutomaÃ§Ã£o em Tempo Real**.

> **Status: Em desenvolvimento â€“ integraÃ§Ã£o completa ainda nÃ£o testada**

---

# ğŸ“Œ Estrutura do Projeto

```
TrabalhoATR/
â”‚
â”œâ”€â”€ main.cpp                  â†’ InicializaÃ§Ã£o do sistema e controle das threads
â”œâ”€â”€ threads.cpp               â†’ Tarefas de tempo real: sensores, falhas, lÃ³gica
â”œâ”€â”€ threads.hpp               â†’ DeclaraÃ§Ãµes das tarefas e variÃ¡vel global running
â”œâ”€â”€ classes.hpp               â†’ DefiniÃ§Ãµes das estruturas de dados e buffer circular
â”œâ”€â”€ mqtt.cpp                  â†’ ComunicaÃ§Ã£o MQTT (sensores + atuadores)
â”œâ”€â”€ mqtt.hpp                  â†’ DeclaraÃ§Ãµes das funÃ§Ãµes MQTT
â”œâ”€â”€ SimulacaoDaMina.cpp       â†’ SimulaÃ§Ã£o fornecida (executada separadamente)
â””â”€â”€ interface.py              â†’ Interface local (opcional, ainda em evoluÃ§Ã£o)
```

---

# ğŸš€ Funcionalidades Implementadas

## âœ” ComunicaÃ§Ã£o MQTT
- Recebimento de todos os sensores da simulaÃ§Ã£o:
  - `i_posicao_x`, `i_posicao_y`, `i_angulo`
  - `i_temperatura`
  - `i_falha_eletrica`, `i_falha_hidraulica`
- Envio dos atuadores para a simulaÃ§Ã£o:
  - `o_aceleracao`
  - `o_direcao`
- Parser completo + push no BufferCircular.

## âœ” Tratamento de Sensores
- Filtro de mÃ©dia mÃ³vel (ordem 5) aplicado a X, Y e Ã¢ngulo.
- ImpressÃ£o de sensores filtrados.

## âœ” Monitoramento de Falhas
Conforme especificaÃ§Ã£o do trabalho:
- Temperatura > 95Â°C â†’ **alerta**
- Temperatura > 120Â°C â†’ **falha crÃ­tica**
- Falhas elÃ©trica/hidrÃ¡ulica detectadas.
- GeraÃ§Ã£o de `FalhaEvento` enviado ao buffer.

## âœ” LÃ³gica de Comando
- Controle total de **modo manual/automÃ¡tico**.
- Travamento por falha crÃ­tica (`e_defeito = true`).
- Rearme de falhas.
- AceleraÃ§Ã£o e direÃ§Ã£o baseadas nos comandos do operador.
- PublicaÃ§Ã£o via MQTT dos atuadores.

## âœ” Encerramento Seguro (SIGINT)
- `Ctrl+C` encerra todas as threads de forma limpa.
- Threads sincronizadas via `std::atomic<bool> running`.

---

# ğŸ§ª Como Executar (SimulaÃ§Ã£o + CaminhÃ£o)

## **1. Iniciar a simulaÃ§Ã£o (terminal 1)**
```bash
./simulacao
```

## **2. Adicionar um caminhÃ£o Ã  simulaÃ§Ã£o (terminal 2)**
```bash
echo "add_truck" | nc localhost 8080
```

## **3. Compilar e executar o caminhÃ£o (terminal 3)**
```bash
g++ -std=c++17 -pthread main.cpp threads.cpp mqtt.cpp -lmosquitto -lboost_system -o caminhao
./caminhao
```

O caminhÃ£o deve:
- Receber e imprimir sensores
- Filtrar posiÃ§Ãµes
- Detectar falhas
- Executar lÃ³gica
- Publicar comandos de direÃ§Ã£o/aceleraÃ§Ã£o
- Movimentar-se na simulaÃ§Ã£o

---

# ğŸ“Œ O que ainda falta implementar

## ğŸ”§ 1. Testes completos com a simulaÃ§Ã£o
- Validar movimentaÃ§Ã£o do caminhÃ£o
- Testar falhas e rearme
- Testar estados do modo automÃ¡tico/manual

## ğŸ”§ 2. Processamento completo de `DadosProcessados`
- Tratamento real alinhado ao PDF do trabalho
- NormalizaÃ§Ã£o e cÃ¡lculo adicional

## ğŸ”§ 3. GeneralizaÃ§Ã£o do ID do caminhÃ£o
Atualmente:
```cpp
publicar_atuadores(1, aceleracao, direcao);
```
Precisa virar:
```cpp
./caminhao 3    # por exemplo
```

## ğŸ”§ 4. IntegraÃ§Ã£o com a Interface Local (Python/Flet)
- Enviar comandos reais para o caminhÃ£o via socket/MQTT
- Mostrar estado do caminhÃ£o
- Mostrar alertas e falhas

## ğŸ”§ 5. Limpeza e documentaÃ§Ã£o final
- ComentÃ¡rios
- Diagrama de arquitetura
- PadronizaÃ§Ã£o
- README detalhado

---

# ğŸ“š ReferÃªncias
- EspecificaÃ§Ã£o oficial do Trabalho Final ATR
- DocumentaÃ§Ã£o MQTT/Mosquitto
- Material da disciplina (SincronizaÃ§Ã£o, IPC, Threads, Tempo Real)

---

# ğŸ‘©â€ğŸ’» Autores
Projeto desenvolvido por **Gustavo, Lariane e Lucas** â€” Engenharia de Controle e AutomaÃ§Ã£o (UFMG).

---
